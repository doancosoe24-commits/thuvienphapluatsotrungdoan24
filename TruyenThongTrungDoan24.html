<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <link rel="shortcut icon" href="./img/logo.png" type="image/x-icon">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thư Viện Pháp Luật Số - Tài Liệu Ngành</title>

  <style>
    :root{
      --primary:#004aad;
      --gold:#ccae6e;
      --bg:#f6f8fb;
      --card:#ffffff;
      --text:#1f2937;
      --muted:#6b7280;
      --radius:16px;
      --shadow:0 10px 25px rgba(0,0,0,0.08);
    }

    *{ box-sizing:border-box; }

    html, body{
      margin:0;
      height:100%;
      font-family:"Segoe UI", Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    body{
      display:flex;
      flex-direction:column;
      width:70%;
      margin:0 auto;
    }

    main{
      flex:1;
      padding:28px 0 40px;
    }

    .back-link{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:8px 14px;
      border-radius:999px;
      background:#156082;
      box-shadow:var(--shadow);
      color:white;
      font-weight:600;
      cursor:pointer;
      transition:.25s;
      margin-bottom:20px;
    }

    .icon-title{
      display:flex;
      align-items:center;
      background:#156082;
      border-radius:15px;
      border:3.5px solid rgba(12,12,12,0.95);
      padding:12px 0;
    }

    .icon-title img{
      width:60px;
      margin:0 15px;
    }

    #pageTitle{
      color:gold;
      text-transform:uppercase;
      font-size:22px;
      font-weight:800;
      margin:0 10px;
    }

    .item_list{
      display:flex;
      align-items:center;
      margin:10px 0;
    }

    .item{
      background:#156082;
      flex:1;
      padding:6px 0;
      color:white;
      box-shadow:var(--shadow);
      cursor:pointer;
      transition:.3s;
      border-radius:var(--radius);
    }

    .item-content{
      display:flex;
      align-items:center;
    }

    .item-content img{
      margin:0 25px;
      width:50px;
    }

    .item-content p{
      font-size:16px;
      font-weight:700;
    }

    .item:hover{
      transform:translateY(-4px);
      box-shadow:0 16px 32px rgba(0,0,0,0.18);
    }

    #loadingBox{
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      padding:60px 0;
      color:var(--primary);
      font-weight:600;
    }

    .loader{
      width:54px;
      height:54px;
      border:4px solid rgba(0,0,0,0.1);
      border-top-color:var(--gold);
      border-radius:50%;
      animation:spin .7s linear infinite;
      margin-bottom:16px;
    }

    @keyframes spin{
      to{ transform:rotate(360deg); }
    }

    @media(max-width:768px){
      body{ width:100%; }
    }
  </style>
</head>

<body>
<div id="header"></div>
<main>
  <span class="back-link" onclick="history.back()">← Quay lại</span>

  <div class="icon-title">
    <img src="./img/logo2.png" alt="">
    <h2 id="pageTitle">Truyền Thống Trung Đoàn 24</h2>
  </div>

  <div id="loadingBox">
    <div class="loader"></div>
    Đang tải dữ liệu...
  </div>

  <div id="list" style="display:none;"></div>
</main>

<div id="footer"></div>
<script src="main.js"></script>
<script>
const webAppUrl = "https://script.google.com/macros/s/AKfycbzvjVVkV4dHAlhuT42mnw4f8pl9BDILKrL0SqF8dBw5LjhMbpBulNTV6DMWNhdbQ2zS/exec";
let ALL_DOCUMENTS = [];

/* ===== Helpers ===== */
function escapeHtml(str){
  return String(str || "")
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;");
}

function toSlug(text){
  text = text.replace(/Đ/g,"D").replace(/đ/g,"d");
  return text.normalize("NFD")
    .replace(/[\u0300-\u036f]/g,"")
    .replace(/[^a-zA-Z0-9 ]/g,"")
    .trim()
    .replace(/\s+/g,"-")
    .toLowerCase();
}

/* ===== Load Data ===== */
async function loadPage(){
  try{
    const res = await fetch(webAppUrl).then(r=>r.json());
    ALL_DOCUMENTS = res.data.TruyenThongDakTo || [];
    renderList(ALL_DOCUMENTS);
  }catch(e){
    document.getElementById("loadingBox").innerText = "Không thể tải dữ liệu";
  }
}

/* ===== Render ===== */
function renderList(data){
  const list = document.getElementById("list");
  const loading = document.getElementById("loadingBox");

  list.innerHTML = "";

  data.forEach(i=>{
    if(!i.title) return;

    const div = document.createElement("div");
    div.className = "item_list";

    div.innerHTML = `
      <div class="item" data-title="${escapeHtml(i.title)}">
        <div class="item-content">
          <img src="./img/6.png">
          <p>${escapeHtml(i.title)}</p>
        </div>
      </div>
    `;

    list.appendChild(div);
  });

  loading.style.display="none";
  list.style.display="block";

  /* ===== Click xử lý điều hướng ===== */
  list.onclick = e => {
    const item = e.target.closest(".item");
    if(!item) return;

    const title = item.dataset.title.trim();

    // Trang riêng cho Lịch Sử Trung Đoàn 24
    if(title.toLowerCase() === "lịch sử trung đoàn 24"){
      window.location.href = "lichsutrungdoan24.html";
    }
    // Các mục còn lại
    else{
      const slug = toSlug(title);
      window.location.href = `TaiLieuNganh_detail.html?slug=${slug}`;
    }
  };
}

loadPage();
</script>

</body>
</html>
