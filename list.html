<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="./img/logo1.jpg" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh s√°ch</title>
</head>

<style>
    html, body { height: 100%; margin: 0; }

    body {
        display: flex;
        flex-direction: column;
        width: 70%;
        margin: 0 auto;
        font-family: Arial, sans-serif;
        background: #f7f9fb;
        color: #333;
    }

    main { flex: 1; padding: 20px 0; }

    .item_list { display: flex; align-items: center; margin-bottom: 18px; }

    .arrow {
        width: 120px; height: 45px;
        background: #ccae6e;
        clip-path: polygon(0% 0%, 78% 0%, 100% 50%, 78% 100%, 0% 100%, 18% 50%);
        display: flex; align-items: center; justify-content: center;
        font-weight: 700; color: #8c6d2a; font-size: 13px;
        margin-right: 12px;
    }

    .item {
        background: #004aad;
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 10px 5px;
        color: #fff;
        border-radius: 5px;
        box-shadow: 0 3px 6px rgba(0,0,0,0.15);
    }

    .item p { margin: 0 0 6px 0; font-size: 16px; font-weight: 700; }

    .btn-new {
        background: #ff3131; color: #ffde59; font-weight: 700;
        border: none; padding: 8px 16px; border-radius: 10px;
        cursor: pointer; font-size: 12px; align-self: flex-end;
        transition: 0.2s;
    }

    @media (max-width: 768px) {
        body { width: 100%; }
        .arrow { width: 50px; height: 35px; font-size: 11px; }
        .item p { font-size: 12px; }
        .btn-new { padding: 6px 12px; font-size: 11px; }
    }
</style>
<body>
<div id="header"></div>

<main>

    <span onclick="history.back()" style="color:#ccae6e;padding:10px;font-weight:600;text-decoration:underline;cursor:pointer;">
        Quay l·∫°i
    </span>

    <h2 id="pageTitle" style="text-align:center;color:#ccae6e;text-transform: uppercase;"></h2>

    <div id="list"></div>

</main>

<div id="footer"></div>
<script src="main.js"></script>
<script>
// üî• ƒê√öNG LINK WEB APP (ph·∫£i l√† /exec)
const webAppUrl = "https://script.google.com/macros/s/AKfycbyIN9wn1ewTZDkx4E1fjyMTa35POlfUGFvjHeoPLFvtuEKiPtNa-z3LvE0Rjf0phVTL/exec";

// L·∫•y slug t·ª´ URL
const params = new URLSearchParams(window.location.search);
const slugURL = params.get("slug")?.toString().trim();   

console.log("Slug URL =", slugURL);

// H√†m t·∫°o item HTML
function createItemHTML(item){
    return `
        <div class="item_list">
            <div class="arrow"></div>
            <div class="item" onclick="goDetail(${item.slug})">
                <p>${item.title}</p>
                <button class="btn-new">C√≥ hi·ªáu l·ª±c</button>
            </div>
        </div>`;
}

// Click item ‚Üí m·ªü list.html?id=xx
function goDetail(slug){
    window.location.href = "detail.html?slug=" + slug;
}

 // s·∫Ω l√† http://127.0.0.1:5500
// L·∫•y d·ªØ li·ªáu t·ª´ Web App
fetch(`${webAppUrl}?ref=${encodeURIComponent(ref)}`)
  .then(res => res.json())
  .then(data => {
      console.log("D·ªØ li·ªáu nh·∫≠n ƒë∆∞·ª£c:", data);

      // l·ªçc theo slug (so s√°nh d·∫°ng chu·ªói)
      const filtered = data.filter(i => String(i.slug).trim() === slugURL);

// üî• c·∫≠p nh·∫≠t ti√™u ƒë·ªÅ = t√™n category, kh√¥ng ph·∫£i slug
        if (filtered.length > 0) {
            document.getElementById("pageTitle").innerText = filtered[0].category;
        } else {
            document.getElementById("pageTitle").innerText = "Kh√¥ng c√≥ d·ªØ li·ªáu";
        }
      // hi·ªÉn th·ªã danh s√°ch
      let html = "";
      filtered.forEach(item => html += createItemHTML(item));

      document.getElementById("list").innerHTML = html || "<p>Kh√¥ng c√≥ d·ªØ li·ªáu.</p>";
  })
  .catch(err => {
      console.error("L·ªói:", err);
      document.getElementById("list").innerHTML = "<p>Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu.</p>";
  });

function loadHTML(id, url) {
  fetch(url)
    .then(res => res.ok ? res.text() : Promise.reject('Network error'))
    .then(html => {
      document.getElementById(id).innerHTML = html;

      if(id === 'header'){
        const searchBtn = document.getElementById("searchBtn");
        const searchInput = document.getElementById("searchInput");

        // Ch·ªâ n√∫t t√¨m ki·∫øm ‚Üí chuy·ªÉn sang timkiem.html
        searchBtn.addEventListener("click", ()=>{
          const key = searchInput.value.trim();
          if(!key) return;
          window.location.href = `timkiem.html?key=${encodeURIComponent(key)}`;
        });
      }
    })
    .catch(err => console.error(`Error loading ${url}:`, err));
}

loadHTML('header','header.html');
loadHTML('footer','footer.html');
</script>

</body>
</html>
