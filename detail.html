<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chi ti·∫øt vƒÉn b·∫£n</title>
<style>
html, body { height: 100%; margin: 0; }
body {
  display: flex;
  flex-direction: column;
  width: 70%;
  margin: 0 auto;
  font-family: Arial, sans-serif;
  color: #fff;
  background: #f7f9fb;
}
main { flex: 1; box-sizing: border-box; }
h2 { text-align: center; color: #004aad; font-weight: 700; }

/* TAB MENU */
.tabs-container { position: relative; display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #d0d6e0; padding-bottom: 8px; }
.tab-btn { font-size: 14px; font-weight: 600; background: #004aad; cursor: pointer; padding: 10px 10px; border-radius: 5px; color: white; transition: 0.25s; }
.tab-btn.active { background: #ccae6e; }
.tab-underline { position: absolute; bottom: -2px; height: 4px; background: #ccae6e; width: 100%; border-radius: 10px; transition: 0.3s; }

/* TAB CONTENT */
.tab-detail { padding: 20px; background: white; border-radius: 14px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); min-height: 180px; }

/* Table Thu·ªôc t√≠nh */
.info-table { width: 100%; border-collapse: collapse; font-size: 16px; border: 1px solid #000; }
.info-table th, .info-table td { text-align: left; padding: 12px 15px; border: 1px solid #000; }
.info-table th { background-color: #f0f4f8; color: #004aad; width: 200px; }
.info-table td { color: #333; }

/* Link PDF */
a { text-decoration: none; color: #004aad; font-weight: 600; }
a:hover { text-decoration: underline; }

@media(max-width: 768px){
    .info-table th, .info-table td { padding: 8px 10px; font-size: 14px; }
    body { width: 100%; }
    h2 { text-align: start; padding: 0 10px; }
}
</style>
</head>
<body>
<main>
    <div id="header"></div>
    <span onclick="history.back()" style="color:#ccae6e;padding:10px;font-weight:600;text-decoration:underline;cursor:pointer;">
        Quay l·∫°i
    </span>
    <h2 id="docTitle"></h2>

    <div class="tabs-container">
        <div class="tab-btn active" data-tab="info">Thu·ªôc t√≠nh</div>
        <div class="tab-btn" data-tab="source">VƒÉn b·∫£n g·ªëc</div>
        <div class="tab-btn" data-tab="download">T·∫£i v·ªÅ</div>
        <div class="tab-underline"></div>
    </div>

    <div class="tab-detail" id="tabContent"></div>
</main>
<div id="footer"></div>

<script>
const webAppUrl = "https://script.google.com/macros/s/AKfycbyIN9wn1ewTZDkx4E1fjyMTa35POlfUGFvjHeoPLFvtuEKiPtNa-z3LvE0Rjf0phVTL/exec";

const params = new URLSearchParams(window.location.search);
const slug = params.get("slug");
const tabContent = document.getElementById("tabContent");
const docTitle = document.getElementById("docTitle");
const tabs = document.querySelectorAll(".tab-btn");
const underline = document.querySelector(".tab-underline");

let currentData = null;

// C·∫≠p nh·∫≠t underline
function updateUnderline(activeTab){
  underline.style.width = activeTab.offsetWidth + "px";
  underline.style.transform = `translateX(${activeTab.offsetLeft}px)`;
}
updateUnderline(document.querySelector(".tab-btn.active"));

// Show tab content
function showTab(data, tab="info"){
  if(!data) return;
  const tabData = {
    info: `<table class="info-table">
             <tbody>
               <tr><th>S·ªë hi·ªáu</th><td>${data.sohieu}</td></tr>
               <tr><th>N∆°i ban h√†nh</th><td>${data.noibanhanh}</td></tr>
               <tr><th>Ng√†y ban h√†nh</th><td>${data.ngaybanhanh}</td></tr>
               <tr><th>Lo·∫°i vƒÉn b·∫£n</th><td>${data.loaivanban}</td></tr>
               <tr><th>Ng∆∞·ªùi k√Ω</th><td>${data.nguoiky}</td></tr>
               <tr><th>Ng√†y hi·ªáu l·ª±c</th><td>${data.ngayhieuluc}</td></tr>
             </tbody>
           </table>`,
    source: `<p><b>VƒÉn b·∫£n g·ªëc:</b></p>
             <a href="${data.pdf_url}" target="_blank">üìÑ Xem PDF</a>`,
    download: `<p><b>T·∫£i xu·ªëng:</b></p>
               <a href="${data.pdf_url}" download>üì• T·∫£i file PDF</a>`
  };
  tabContent.innerHTML = tabData[tab];
  docTitle.innerText = data.title;
}

// Tab click
tabs.forEach(tab=>{
  tab.addEventListener("click", ()=>{
    document.querySelector(".tab-btn.active").classList.remove("active");
    tab.classList.add("active");
    showTab(currentData, tab.getAttribute("data-tab"));
    updateUnderline(tab);
  });
});

// Load d·ªØ li·ªáu theo slug
const ref = window.location.origin; // s·∫Ω l√† http://127.0.0.1:5500
if(slug){
  fetch(`${webAppUrl}?slug=${encodeURIComponent(slug)}&ref=${encodeURIComponent(ref)}`)
  .then(res => res.json())
  .then(data => {
    if(data.length>0){
      currentData = data[0];
      showTab(currentData);
    } else {
      tabContent.innerHTML = "<p>Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu.</p>";
      docTitle.innerText = "Kh√¥ng t√¨m th·∫•y vƒÉn b·∫£n";
    }
  })
  .catch(err=>{
    console.error(err);
    tabContent.innerHTML = "<p>Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu.</p>";
    docTitle.innerText = "L·ªói";
  });
} else {
  tabContent.innerHTML = "<p>Kh√¥ng c√≥ slug.</p>";
  docTitle.innerText = "Kh√¥ng x√°c ƒë·ªãnh vƒÉn b·∫£n";
}

// Load header/footer
function loadHTML(id,url){
  fetch(url)
    .then(res=>res.ok?res.text():Promise.reject("Network error"))
    .then(html=>document.getElementById(id).innerHTML = html)
    .catch(err=>console.error(err));
}
loadHTML('header','header.html');
loadHTML('footer','footer.html');
</script>
</body>
</html>
