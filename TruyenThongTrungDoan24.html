<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <link rel="shortcut icon" href="./img/logo.png" type="image/x-icon">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thư Viện Pháp Luật Số - Tài Liệu Ngành</title>

  <style>
    :root{
      --primary:#004aad;
      --gold:#ccae6e;
      --bg:#f6f8fb;
      --card:#ffffff;
      --text:#1f2937;
      --muted:#6b7280;
      --radius:16px;
      --shadow:0 10px 25px rgba(0,0,0,0.08);
    }

    *{ box-sizing:border-box; }

    html, body{
      margin:0;
      height:100%;
      font-family:"Segoe UI", Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    body{
      display:flex;
      flex-direction:column;
      width:70%;
      margin:0 auto;
    }

    main{
      flex:1;
      padding:28px 0 40px;
    }

    .back-link{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:8px 14px;
      border-radius:999px;
      background:#156082;
      box-shadow:var(--shadow);
      color:white;
      font-weight:600;
      cursor:pointer;
      transition:.25s;
      margin-bottom:20px;
    }

    .icon-title{
      display:flex;
      align-items:center;
      background:#156082;
      border-radius:15px;
      border:3.5px solid rgba(12,12,12,0.95);
      padding:12px 0;
    }

    .icon-title img{
      width:60px;
      margin:0 15px;
    }

    #pageTitle{
      color:gold;
      text-transform:uppercase;
      font-size:22px;
      font-weight:800;
      margin:0 10px;
    }

    .item_list{
      display:flex;
      align-items:center;
      margin:10px 0;
    }

    .item{
      background:#156082;
      flex:1;
      padding:6px 0;
      color:white;
      box-shadow:var(--shadow);
      cursor:pointer;
      transition:.3s;
      border-radius:var(--radius);
    }

    .item:hover{
      transform:translateY(-4px);
      box-shadow:0 18px 35px rgba(0,0,0,0.12);
    }

    .item-content{
      display:flex;
      align-items:center;
    }

    .item-content img{
      margin:0 25px;
      width:50px;
    }

    .item-content p{
      font-size:16px;
      font-weight:700;
      margin:0;
    }

    #loadingBox{
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      padding:60px 0;
      color:var(--primary);
      font-weight:600;
    }

    .loader{
      width:54px;
      height:54px;
      border:4px solid rgba(0,0,0,0.1);
      border-top-color:var(--gold);
      border-radius:50%;
      animation:spin .7s linear infinite;
      margin-bottom:16px;
    }

    @keyframes spin{
      to{ transform:rotate(360deg); }
    }

    @media(max-width:768px){
      body{ width:100%; padding:10px; }
      .item-content img{ margin:0 12px; width:42px; }
      .icon-title{ padding:10px; }
      #pageTitle{ font-size:18px; }
    }
  </style>
</head>

<body>
  <div id="header"></div>

  <main>
    <span class="back-link" onclick="history.back()">← Quay lại</span>

    <div class="icon-title" role="banner" aria-label="Tiêu đề">
      <img src="./img/logo2.png" alt="Logo">
      <h2 id="pageTitle">Truyền Thống Trung Đoàn 24</h2>
    </div>

    <div id="loadingBox">
      <div class="loader" aria-hidden="true"></div>
      <div>Đang tải dữ liệu...</div>
    </div>

    <div id="list" style="display:none;"></div>
  </main>

  <div id="footer"></div>

  <!-- nếu bạn có main.js, vẫn giữ import (nếu không có, không ảnh hưởng) -->
  <script src="main.js"></script>

  <script>
    const webAppUrl = "https://script.google.com/macros/s/AKfycbxgidwuQo9UTNHrb85ZFbY7YyKGWxR1HHLtLGpfbu4ILyMGHbSj7b0XrYSCsZEv8XjW/exec";
    let ALL_DOCUMENTS = [];

    /* ===== Helpers ===== */
    function escapeHtml(str){
      return String(str || "")
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;");
    }

    function toSlug(text){
      text = String(text || "");
      text = text.replace(/Đ/g,"D").replace(/đ/g,"d");
      return text.normalize("NFD")
        .replace(/[\u0300-\u036f]/g,"")
        .replace(/[^a-zA-Z0-9 ]/g,"")
        .trim()
        .replace(/\s+/g,"-")
        .toLowerCase();
    }

    /* ===== Load Data ===== */
    async function loadPage(){
      try{
        const res = await fetch(webAppUrl);
        if(!res.ok) throw new Error("Network response was not ok");
        const json = await res.json();
        ALL_DOCUMENTS = (json && json.data && json.data.TruyenThongDakTo) ? json.data.TruyenThongDakTo : [];
        renderList(ALL_DOCUMENTS);
      }catch(e){
        const loading = document.getElementById("loadingBox");
        loading.innerText = "Không thể tải dữ liệu";
        console.error("Lỗi tải dữ liệu:", e);
      }
    }

    /* ===== Render ===== */
    function renderList(data){
      const list = document.getElementById("list");
      const loading = document.getElementById("loadingBox");

      list.innerHTML = "";

      if(!Array.isArray(data) || data.length === 0){
        loading.innerHTML = "Không có mục nào";
        list.style.display = "none";
        return;
      }

      data.forEach((i, idx) => {
        if(!i || !i.title) return;

        const div = document.createElement("div");
        div.className = "item_list";

        div.innerHTML = `
          <div class="item" data-index="${idx}">
            <div class="item-content">
              <img src="./img/6.png" alt="icon">
              <p></p>
            </div>
          </div>
        `;

        const item = div.querySelector(".item");
        // Lưu title nguyên gốc để xử lý; hiển thị dùng textContent (an toàn)
        item.dataset.title = i.title || "";
        div.querySelector(".item-content p").textContent = i.title || "";

        list.appendChild(div);
      });

      loading.style.display = "none";
      list.style.display = "block";

      /* ===== Click xử lý điều hướng ===== */
      list.onclick = e => {
        const item = e.target.closest(".item");
        if(!item) return;

        const index = Number(item.dataset.index);
        const title = (item.dataset.title || "").trim();

        // Nếu là item đầu tiên => chuyển về lichsutrungdoan24.html
        if(index === 0){
          window.location.href = "lichsutrungdoan24.html";
          return;
        }

        // nếu tiêu đề đúng "lịch sử trung đoàn 24" (phòng trường hợp thứ tự khác)
        if(title.toLowerCase() === "lịch sử trung đoàn 24"){
          window.location.href = "lichsutrungdoan24.html";
          return;
        }

        // các mục còn lại dùng slug
        const slug = toSlug(title);
        window.location.href = `TaiLieuNganh_detail.html?slug=${slug}`;
      };
    }

    // Khởi chạy
    loadPage();
  </script>
</body>
</html>
